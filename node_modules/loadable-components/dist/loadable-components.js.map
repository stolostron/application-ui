{"version":3,"file":"loadable-components.js","sources":["../src/componentTracker.js","../src/constants.js","../src/loadComponents.js","../src/getState.js","../src/utils/resolveModuleDefault.js","../src/config.js","../src/loadable.js","../src/index.js"],"sourcesContent":["const components = {}\n\nexport const track = (component, modules) => {\n  const id = modules.join('-')\n  components[id] = component\n  return id\n}\n\nexport const get = id => components[id]\nexport const getAll = () => ({ ...components })\n","export const LOADABLE_STATE = '__LOADABLE_STATE__'\nexport const LOADABLE = '@@loadable-components/loadable'\n","/* eslint-env browser */\nimport { LOADABLE, LOADABLE_STATE } from './constants'\nimport * as componentTracker from './componentTracker'\n\nfunction loadState(rootState) {\n  if (!rootState.children) return Promise.resolve(null)\n\n  return Promise.all(\n    rootState.children.map(state => {\n      const component = componentTracker.get(state.id)\n\n      if (!component) {\n        console.warn(\n          'loadable-component client modules:',\n          componentTracker.getAll(),\n        )\n        console.warn(\n          'loadable-component server modules:',\n          window[LOADABLE_STATE],\n        )\n        throw new Error(\n          `loadable-components: module \"${\n            state.id\n          }\" is not found, client and server modules are not sync. You are probably not using the same resolver on server and client.`,\n        )\n      }\n\n      const getLoadable = component[LOADABLE]\n\n      if (typeof getLoadable !== 'function') {\n        throw new Error(\n          `loadable-components: module \"${\n            state.id\n          }\" is not a laodable component, please verify your SSR setup`,\n        )\n      }\n\n      return getLoadable()\n        .load()\n        .then(() => loadState(state))\n    }),\n  )\n}\n\nfunction loadComponents() {\n  if (typeof window === 'undefined') {\n    throw new Error(\n      'loadable-components: `loadComponents` must be called client-side: `window` is undefined',\n    )\n  }\n\n  const state = window[LOADABLE_STATE]\n  if (!state) {\n    throw new Error(\n      'loadable-components state not found. ' +\n        'You have a problem server-side. ' +\n        'Please verify that you have called `loadableState.getScriptTag()` server-side.',\n    )\n  }\n\n  return loadState(state)\n}\n\nexport default loadComponents\n","/* eslint-env browser */\n/* eslint-disable import/prefer-default-export */\nimport { getAll as getAllComponents } from './componentTracker'\nimport { LOADABLE_STATE } from './constants'\n\nfunction getState() {\n  const componentByIds = getAllComponents()\n  const children = Object.keys(componentByIds).reduce((ids, id) => {\n    const component = componentByIds[id]\n    if (component.loadingPromise) return [...ids, { id: component.componentId }]\n    return ids\n  }, [])\n  return { [LOADABLE_STATE]: { children } }\n}\n\nexport default getState\n","/* eslint-disable no-underscore-dangle */\nconst resolveModuleDefault = module =>\n  module.__esModule ? module.default : module\n\nexport default resolveModuleDefault\n","/* eslint-disable no-underscore-dangle */\n\nconst _config = {\n  // Automatically load components in hot reload environment\n  hotReload: process.env.NODE_ENV === 'development',\n}\n\nexport const setConfig = config => Object.assign(_config, config)\nexport const getConfig = () => _config\n","/* eslint-disable react/sort-comp */\nimport React from 'react'\nimport hoistNonReactStatics from 'hoist-non-react-statics'\nimport { LOADABLE } from './constants'\nimport resolveModuleDefault from './utils/resolveModuleDefault'\nimport * as componentTracker from './componentTracker'\nimport { getConfig } from './config'\n\nconst EmptyComponent = () => null\n\nfunction loadable(\n  getComponent,\n  {\n    ErrorComponent = EmptyComponent,\n    LoadingComponent = EmptyComponent,\n    render,\n    modules,\n  } = {},\n) {\n  class LoadableComponent extends React.Component {\n    static Component = null\n    static loadingPromise = null\n\n    static load() {\n      if (!LoadableComponent.loadingPromise) {\n        LoadableComponent.loadingPromise = getComponent()\n          .then(module => {\n            const Component = resolveModuleDefault(module)\n            LoadableComponent.Component = Component\n            hoistNonReactStatics(LoadableComponent, Component, {\n              Component: true,\n              loadingPromise: true,\n              load: true,\n              [LOADABLE]: true,\n            })\n            return Component\n          })\n          .catch(error => {\n            LoadableComponent.loadingPromise = null\n            throw error\n          })\n      }\n\n      return LoadableComponent.loadingPromise\n    }\n\n    constructor(props) {\n      super(props)\n      this.state = {\n        Component: LoadableComponent.Component,\n        error: null,\n        loading: !LoadableComponent.Component,\n      }\n      this.mounted = false\n      this.loadingPromise = null\n\n      if (\n        typeof window !== 'undefined' &&\n        this.state.Component === null &&\n        this.loadingPromise === null\n      ) {\n        this.loadingPromise = LoadableComponent.load()\n          .then(Component => {\n            this.safeSetState({ Component, loading: false })\n          })\n          .catch(error => {\n            this.safeSetState({ error, loading: false })\n          })\n      }\n    }\n\n    componentDidMount() {\n      this.mounted = true\n    }\n\n    componentWillUnmount() {\n      this.mounted = false\n    }\n\n    safeSetState(state) {\n      if (!this.mounted) return\n      this.setState(state)\n    }\n\n    render() {\n      const { Component, error } = this.state\n\n      if (typeof render === 'function') {\n        return render({\n          ...this.state,\n          ownProps: this.props,\n        })\n      }\n\n      if (Component !== null) {\n        return <Component {...this.props} />\n      }\n\n      if (error !== null) {\n        return <ErrorComponent error={error} ownProps={this.props} />\n      }\n\n      return <LoadingComponent {...this.props} />\n    }\n  }\n\n  LoadableComponent[LOADABLE] = () => LoadableComponent\n\n  if (module && module.hot && getConfig().hotReload) {\n    LoadableComponent.load()\n  }\n\n  if (modules) {\n    const id = componentTracker.track(LoadableComponent, modules)\n    LoadableComponent.componentId = id\n  }\n\n  return LoadableComponent\n}\n\nexport default loadable\n","import * as tracker from './componentTracker'\n\nexport { default as loadComponents } from './loadComponents'\nexport { default as getState } from './getState'\nexport { LOADABLE } from './constants'\nexport { default } from './loadable'\nexport { setConfig } from './config'\nexport const componentTracker = tracker\n"],"names":["components","track","component","modules","id","join","get","getAll","LOADABLE_STATE","LOADABLE","loadState","rootState","children","Promise","resolve","all","map","componentTracker","state","console","warn","window","Error","getLoadable","load","then","loadComponents","getState","componentByIds","getAllComponents","Object","keys","reduce","ids","loadingPromise","componentId","resolveModuleDefault","module","__esModule","default","_config","hotReload","process","setConfig","assign","config","getConfig","EmptyComponent","loadable","getComponent","ErrorComponent","LoadingComponent","render","LoadableComponent","Component","hoistNonReactStatics","catch","error","props","loading","mounted","safeSetState","componentDidMount","componentWillUnmount","setState","ownProps","React","hot","tracker"],"mappings":"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"}