{{! ========================================================== }}
{{! ========================================================== }}
{{! ==================Application ============================ }}
{{! ========================================================== }}
{{! ========================================================== }}
                         

apiVersion: argoproj.io/v1alpha1
kind: ApplicationSet
metadata:
  name: {{{appSetName}}}
  namespace: {{{argoServer}}}
spec:
  generators:
    - clusterDecisionResource:
        configMapRef: acm-placement
        {{#if decisionResourceName}}
        name: {{{decisionResourceName}}}  
        {{else}}  
        name: {{appSetName}}-placement
        {{/if}}                
        requeueAfterSeconds: {{{requeueTime}}}
  template:
    metadata:
      name: '{{{appSetName}}}-{{curlyName}}'
    spec:
      project: "default"
      source:

      
{{#each channels}}

{{#switch channelType}}

{{! ========================================================== }}
{{! ========================================================== }}
{{! ==================Github channel ========================= }}
{{! ========================================================== }}
{{! ========================================================== }}
{{#case 'github'}}

{{>templateGit 
  curlyServer=../../../curlyServer
  destinationNS=../../../destinationNS
  channelName=../../channelName
  channelNamespace=../../channelNamespace
  channelNamespaceExists=../../channelNamespaceExists
  githubURL=../../githubURL
  githubPath=../../githubPath
  githubBranch=../../githubBranch
  prune=../../../prune
  allowEmpty=../../../allowEmpty
  selfHeal=../../../selfHeal
  validate=../../../validate
  pruneLast=../../../pruneLast
  replace=../../../replace
  createNamespace=../../../createNamespace
  applyOutOfSyncOnly=../../../applyOutOfSyncOnly
  prunePropagationPolicy=../../../prunePropagationPolicy
  propagationPolicy=../../../propagationPolicy
}}
{{/case}}


{{! ========================================================== }}
{{! ========================================================== }}
{{! ==================Helm channel ========================= }}
{{! ========================================================== }}
{{! ========================================================== }}
{{#case 'helmrepo'}}

{{>templateHelm 
  curlyServer=../../../curlyServer
  destinationNS=../../../destinationNS
  channelName=../../channelName
  channelNamespace=../../channelNamespace
  channelNamespaceExists=../../channelNamespaceExists
  helmURL=../../helmURL
  helmChartName=../../helmChartName
  helmPackageVersion=../../helmPackageVersion
  allowEmpty=../../../allowEmpty
  selfHeal=../../../selfHeal
  validate=../../../validate
  createNamespace=../../../createNamespace
  applyOutOfSyncOnly=../../../applyOutOfSyncOnly
  prunePropagationPolicy=../../../prunePropagationPolicy
  propagationPolicy=../../../propagationPolicy
}}
{{/case}}


{{/switch}}
{{/each}}


{{! ========================================================== }}
{{! ========================================================== }}
{{! ==================placement ========================= }}
{{! ========================================================== }}
{{! ========================================================== }}  

{{>templatePlacement 
  decisionResourceName=../../../decisionResourceName
  existingrule-checkbox=../../../existingrule-checkbox
  clusterSelector=../../../clusterSelector
  selfLinks=../../../selfLinks
}}