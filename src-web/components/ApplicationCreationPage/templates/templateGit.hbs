{{! ========================================================== }}
{{! ========================================================== }}
{{! ==================Github channel ========================= }}
{{! ========================================================== }}
{{! ========================================================== }}

{{#unless channelNamespace}}
---
apiVersion: v1                      
kind: Namespace
metadata:
  name: {{{@root.name}}}-{{{channelName}}}-ns-{{@index}}
---
apiVersion: apps.open-cluster-management.io/v1
kind: Channel
metadata:
  name: {{{@root.name}}}-{{{channelName}}}-{{@index}}
  namespace: {{{@root.name}}}-{{{channelName}}}-ns-{{@index}}
spec:
  type: Git
{{#if githubURL}}
  pathname: '{{{githubURL}}}'  ##channels.{{@index}}.githubURL
{{/if}}
{{#if githubUser}}
  secretRef:
    name: {{{@root.name}}}-git-authentication-{{@index}}
---
apiVersion: v1
kind: Secret
metadata:
  name: {{{@root.name}}}-git-authentication-{{@index}}
  namespace: {{{@root.name}}}-{{{channelName}}}-ns-{{@index}}
data:
  user: {{{githubUser}}}
  accessToken: {{{githubAccessId}}}
{{/if}}
{{/unless}}      
---
apiVersion: apps.open-cluster-management.io/v1
kind: Subscription
metadata:
  annotations:
    apps.open-cluster-management.io/git-branch: {{{githubBranch}}}
    apps.open-cluster-management.io/git-path: {{{githubPath}}}
    {{#if gitReconcileOption}}
    apps.open-cluster-management.io/reconcile-option: merge
    {{/if}}
  labels:
    app: {{{@root.name}}}
  name: {{{@root.name}}}-subscription-{{@index}}
  namespace: {{{@root.namespace}}}
spec:
{{#if preJob}} 
  prehook: {{{@root.namespace}}}/{{{preJob}}}
{{/if}}
{{#if postJob}} 
  posthook: {{{@root.namespace}}}/{{{postJob}}}
{{/if}}
{{#if channelNamespace}}
  channel: {{{channelNamespace}}}/{{{channelName}}}
{{else}}
  channel: {{{@root.name}}}-{{{channelName}}}-ns-{{@index}}/{{{@root.name}}}-{{{channelName}}}-{{@index}}
{{/if}}
