
{{! ========================================================== }}
{{! ========================================================== }}
{{! ==================Application ============================ }}
{{! ========================================================== }}
{{! ========================================================== }}
{{#if userDefinedNamespace}}
apiVersion: v1                    
kind: Namespace
metadata:
  name: {{{namespace}}}                             
---
{{/if}}
apiVersion: app.k8s.io/v1beta1
kind: Application
metadata:
  name: {{{name}}}
  namespace: {{{namespace}}}
spec:
  componentKinds:
  - group: apps.open-cluster-management.io
    kind: Subscription
  descriptor: {}
  selector:
    matchExpressions:
      - key: app
        operator: In
        values: 
          - {{{name}}}


{{! ========================================================== }}
{{! ========================================================== }}
{{! ==================Channel(s) ============================= }}
{{! ========================================================== }}
{{! ========================================================== }}


{{#each channels}}

{{#switch channelType}}

{{! ========================================================== }}
{{! ========================================================== }}
{{! ==================Github channel ========================= }}
{{! ========================================================== }}
{{! ========================================================== }}
{{#case 'github'}}

{{>templateGit 
  channelName=../channelName 
  channelNamespace=../channelNamespace 
  githubURL=../githubURL 
  githubUser=../githubUser 
  githubAccessId=../githubAccessId 
  githubBranch=../githubBranch 
  githubPath=../githubPath 
  preJob=../preJob 
  postJob=../postJob
}}

{{>templatePlacement 
  timeWindow=../timeWindow
  selectedRuleName=../selectedRuleName
  existingrule-checkbox=../existingrule-checkbox
  local-cluster-checkbox=../local-cluster-checkbox
  clusterSelector=../clusterSelector
  clusterReplicas=../clusterReplicas
  online-cluster-only-checkbox=../online-cluster-only-checkbox
}}

{{/case}}


{{! ========================================================== }}
{{! ========================================================== }}
{{! ==================Helmrepo channel ==================== }}
{{! ========================================================== }}
{{! ========================================================== }}
{{#case 'helmrepo'}}

{{>templateHelm
  channelName=../channelName 
  channelNamespace=../channelNamespace 
  helmURL=../helmURL
  helmUser=../helmUser
  helmPassword=../helmPassword
  helmChartName=../helmChartName
  helmPackageVersion=../helmPackageVersion
  preJob=../preJob 
  postJob=../postJob
}}


{{>templatePlacement 
  timeWindow=../timeWindow
  selectedRuleName=../selectedRuleName
  existingrule-checkbox=../existingrule-checkbox
  local-cluster-checkbox=../local-cluster-checkbox
  clusterSelector=../clusterSelector
  clusterReplicas=../clusterReplicas
  online-cluster-only-checkbox=../online-cluster-only-checkbox
}}

{{/case}}


{{! ========================================================== }}
{{! ========================================================== }}
{{! ==================Objectstore channel ==================== }}
{{! ========================================================== }}
{{! ========================================================== }}
{{#case 'objectstore'}}

{{>templateObjectBucket
  channelName=../channelName 
  channelNamespace=../channelNamespace
  objectstoreURL=../objectstoreURL
  accessKey=../accessKey
  secretKey=../secretKey
  preJob=../preJob 
  postJob=../postJob
}}

{{>templatePlacement 
  timeWindow=../timeWindow
  selectedRuleName=../selectedRuleName
  existingrule-checkbox=../existingrule-checkbox
  local-cluster-checkbox=../local-cluster-checkbox
  clusterSelector=../clusterSelector
  clusterReplicas=../clusterReplicas
  online-cluster-only-checkbox=../online-cluster-only-checkbox
}}

{{/case}}


{{! ========================================================== }}
{{! ========================================================== }}
{{! ==================Local cluster channel ================== }}
{{! ========================================================== }}
{{! ========================================================== }}
{{#case 'deployable'}}

{{>templateLocalCluster
  channelName=../channelName 
  channelNamespace=../channelNamespace 
  preJob=../preJob 
  postJob=../postJob
}}

{{>templatePlacement 
  timeWindow=../timeWindow
  selectedRuleName=../selectedRuleName
  existingrule-checkbox=../existingrule-checkbox
  local-cluster-checkbox=../local-cluster-checkbox
  clusterSelector=../clusterSelector
  clusterReplicas=../clusterReplicas
  online-cluster-only-checkbox=../online-cluster-only-checkbox
}}

{{/case}}

{{/switch}}
{{/each}}

